
name: Deploy to DGX Cloud

on:
  workflow_dispatch:   # manual trigger
  push:
    branches:
      - main

jobs:
  sanity:
    runs-on: ubuntu-latest
    environment: dgx-cloud-prod

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Confirm environment and secrets are present
        run: |
          echo "Environment: dgx-cloud-prod "
          test -n "${{ secrets.NIM_API_URL }}" || (echo "Missing NIM_API_URL secret" && exit 1)
          test -n "${{ secrets.NGC_API_KEY }}" || (echo "Missing NGC_API_KEY secret" && exit 1)
          test -n "${{ secrets.NVIDIA_SPEECH_API_KEY }}" || (echo "Missing NVIDIA_SPEECH_API_KEY secret" && exit 1)
          test -n "${{ secrets.RIVA_ASR_FUNCTION_ID }}" || (echo "Missing RIVA_ASR_FUNCTION_ID secret" && exit 1)
          test -n "${{ secrets.RIVA_TTS_FUNCTION_ID }}" || (echo "Missing RIVA_TTS_FUNCTION_ID secret" && exit 1)
          echo "All required secrets found "

      - name: Print variables (masked)
        run: |
          echo "NIM_API_URL is set (value masked by GitHub)"
          echo "Will use DGX Cloud hosted endpoints from your app, not from CI."
